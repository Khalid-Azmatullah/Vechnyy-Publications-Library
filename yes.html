<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>GitHub Read/Write Example</title>
</head>
<body>
  <h1>GitHub API Example</h1>
  <button id="btn-read">Read File</button>
  <button id="btn-write">Write File</button>
  <pre id="output"></pre>

  <script>
    // ===== CONFIG: fill these in =====
    const GITHUB_TOKEN = "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";  // your personal access token
    const OWNER = "Mr-Codes-cant-code";
    const REPO = "vechnyy-database";
    const BRANCH = "main";   // branch to read/write
    // path to the file inside the repo
    const FILE_PATH = "itshallexist/example.txt";
    // commit message for write
    const COMMIT_MESSAGE = "Update example.txt via JS";

    const apiBase = "https://api.github.com";

    function log(msg) {
      const out = document.getElementById("output");
      out.textContent += msg + "\n";
    }

    async function getFileContent(path) {
      const url = `${apiBase}/repos/${OWNER}/${REPO}/contents/${encodeURIComponent(path)}?ref=${BRANCH}`;
      const resp = await fetch(url, {
        method: "GET",
        headers: {
          "Accept": "application/vnd.github+json",
          "Authorization": `Bearer ${GITHUB_TOKEN}`
        }
      });
      if (!resp.ok) {
        throw new Error(`GET failed: ${resp.status} ${resp.statusText}`);
      }
      const data = await resp.json();
      return data;  // contains fields: content (base64), sha, etc.
    }

    async function writeFile(path, newContent, sha = null) {
      // newContent: a string
      const url = `${apiBase}/repos/${OWNER}/${REPO}/contents/${encodeURIComponent(path)}`;
      const body = {
        message: COMMIT_MESSAGE,
        content: btoa(unescape(encodeURIComponent(newContent))), // base64 encode
        branch: BRANCH
      };
      if (sha) {
        body.sha = sha;
      }
      const resp = await fetch(url, {
        method: "PUT",
        headers: {
          "Accept": "application/vnd.github+json",
          "Authorization": `Bearer ${GITHUB_TOKEN}`
        },
        body: JSON.stringify(body)
      });
      if (!resp.ok) {
        const errText = await resp.text();
        throw new Error(`PUT failed: ${resp.status} ${resp.statusText}: ${errText}`);
      }
      const respData = await resp.json();
      return respData;
    }

    document.getElementById("btn-read").onclick = async () => {
      try {
        const file = await getFileContent(FILE_PATH);
        const contentDecoded = decodeURIComponent(escape(atob(file.content)));
        log(`File content (SHA: ${file.sha}):\n${contentDecoded}`);
      } catch (err) {
        log("Error reading file: " + err);
      }
    };

    document.getElementById("btn-write").onclick = async () => {
      try {
        // First get the existing file (to get its sha)
        let existing = null;
        try {
          existing = await getFileContent(FILE_PATH);
        } catch (e) {
          // file may not exist yet, that's okay
          log("File does not exist; will create new");
        }
        const oldContent = existing ? decodeURIComponent(escape(atob(existing.content))) : "";
        log("Old content: " + oldContent);

        const newContent = oldContent + "\nAppended line at some time i dont remember " + new Date().toISOString();
        const result = await writeFile(FILE_PATH, newContent, existing ? existing.sha : null);
        log("Write result: " + JSON.stringify(result, null, 2));
      } catch (err) {
        log("Error writing file: " + err);
      }
    };
  </script>
</body>
</html>
